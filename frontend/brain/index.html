<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chalie Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css" integrity="sha512-9xKTRVabjVeZmc+GUW8GgSmcREDunMM+Dt/GrzchfN8tkwHizc5RP4Ok/MXFFy5rIjJjzhndFScTceq5e6GvVQ==" crossorigin="anonymous" referrerpolicy="no-referrer">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <div class="logo">
                <img src="/icons/icon.png" class="logo-img" alt="Chalie">
                <span class="logo-badge">Dashboard</span>
            </div>
            <nav class="tabs" id="mainTabs">
                <button class="tab active" data-tab="providers">Providers</button>
                <button class="tab" data-tab="cognition">Cognition</button>
                <button class="tab" data-tab="embodiment">Embodiment</button>
                <button class="tab" data-tab="scheduler">Scheduler</button>
                <button class="tab" data-tab="lists">Lists</button>
                <button class="tab" data-tab="documents">Documents</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main" id="mainContent" style="display:none">
        <!-- Providers Tab -->
        <div class="tab-panel active" id="tab-providers">
            <div class="panel-header">
                <h2>LLM Providers</h2>
                <button class="btn btn-primary" id="addProviderBtn">+ Add Provider</button>
            </div>
            <div id="providersList" class="providers-list">
                <div class="loading">Loading providers...</div>
            </div>
        </div>

        <!-- Cognition Tab -->
        <div class="tab-panel" id="tab-cognition">
            <div class="panel-header">
                <h2>Cognition</h2>
                <div class="panel-header-actions">
                    <span class="obs-timestamp" id="obsTimestamp"></span>
                    <button class="btn btn-secondary" id="obsRefreshBtn">Refresh</button>
                </div>
            </div>

            <!-- Sub-tabs with human-language labels -->
            <div class="cognition-subtabs" id="cognitionSubtabs">
                <button class="filter-tab active" data-subtab="jobs">Jobs</button>
                <button class="filter-tab" data-subtab="routing">Thinking</button>
                <button class="filter-tab" data-subtab="memory">Memory</button>
                <button class="filter-tab" data-subtab="tools">Tools</button>
                <button class="filter-tab" data-subtab="identity">Identity</button>
                <button class="filter-tab" data-subtab="tasks">Working On</button>
                <button class="filter-tab" data-subtab="understanding">Understanding</button>
            </div>

            <!-- Jobs sub-panel (existing content, unchanged) -->
            <div class="cognition-subpanel active" id="subtab-jobs">
                <p class="panel-desc">Assign each cognitive job to an LLM provider. Changes auto-save.</p>
                <div id="cognitionList" class="cognition-list">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Thinking (Routing) sub-panel -->
            <div class="cognition-subpanel" id="subtab-routing">
                <div id="routingContent"></div>
            </div>

            <!-- Memory sub-panel -->
            <div class="cognition-subpanel" id="subtab-memory">
                <div id="memoryContent"></div>
            </div>

            <!-- Tools sub-panel -->
            <div class="cognition-subpanel" id="subtab-tools">
                <div id="toolsObsContent"></div>
            </div>

            <!-- Identity sub-panel -->
            <div class="cognition-subpanel" id="subtab-identity">
                <div id="identityContent"></div>
            </div>

            <!-- Working On (Tasks) sub-panel -->
            <div class="cognition-subpanel" id="subtab-tasks">
                <div id="tasksContent"></div>
            </div>

            <!-- Understanding sub-panel -->
            <div class="cognition-subpanel" id="subtab-understanding">
                <div id="understandingContent"></div>
            </div>
        </div>

        <!-- Embodiment Tab -->
        <div class="tab-panel" id="tab-embodiment">
            <div class="panel-header">
                <h2>Embodiment</h2>
                <div class="panel-header-actions">
                    <input type="search" id="toolSearch" placeholder="Search skills‚Ä¶" class="search-input">
                    <button class="btn btn-primary" id="addToolBtn">+ Add Tool</button>
                </div>
            </div>

            <!-- Recommended Section -->
            <div class="embodiment-section" id="recommendedSection">
                <div class="section-header">
                    <span class="section-title">Recommended</span>
                    <a href="#" class="section-link" id="browseMarketplaceBtn">Browse marketplace ‚Üí</a>
                </div>
                <div class="tools-grid tools-grid--recommended" id="recommendedGrid">
                    <div class="tool-card tool-card--marketplace">
                        <div class="tool-card__header">
                            <div class="tool-card__icon">üå¶</div>
                            <div><div class="tool-card__name">Weather</div><div class="tool-card__category">productivity</div></div>
                        </div>
                        <p class="tool-card__desc">Real-time weather forecasts and alerts based on your location.</p>
                        <div class="tool-card__footer">
                            <span class="tool-card__status --marketplace">Marketplace</span>
                            <button class="tool-card__btn --primary" disabled>Coming soon</button>
                        </div>
                    </div>
                    <div class="tool-card tool-card--marketplace">
                        <div class="tool-card__header">
                            <div class="tool-card__icon">üìÖ</div>
                            <div><div class="tool-card__name">Calendar</div><div class="tool-card__category">productivity</div></div>
                        </div>
                        <p class="tool-card__desc">Read and write Google Calendar events on your behalf.</p>
                        <div class="tool-card__footer">
                            <span class="tool-card__status --marketplace">Marketplace</span>
                            <button class="tool-card__btn --primary" disabled>Coming soon</button>
                        </div>
                    </div>
                    <div class="tool-card tool-card--marketplace">
                        <div class="tool-card__header">
                            <div class="tool-card__icon">üîç</div>
                            <div><div class="tool-card__name">Web Search</div><div class="tool-card__category">research</div></div>
                        </div>
                        <p class="tool-card__desc">Search the web and retrieve summaries of results in real time.</p>
                        <div class="tool-card__footer">
                            <span class="tool-card__status --marketplace">Marketplace</span>
                            <button class="tool-card__btn --primary" disabled>Coming soon</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Installed Tools Section -->
            <div class="embodiment-section">
                <div class="section-header">
                    <span class="section-title">Installed</span>
                </div>
                <div id="toolsGrid" class="tools-grid">
                    <div class="loading">Loading skills‚Ä¶</div>
                </div>
            </div>
        </div>
        <!-- Lists Tab -->
        <div class="tab-panel" id="tab-lists">
            <div class="panel-header">
                <h2>Lists</h2>
                <button class="btn btn-primary" id="newListBtn">+ New List</button>
            </div>
            <div class="lists-container" id="listsContainer">
                <div class="loading">Loading lists‚Ä¶</div>
            </div>
        </div>

        <!-- Documents Tab -->
        <div class="tab-panel" id="tab-documents">
            <div class="panel-header">
                <h2>Documents</h2>
                <div class="panel-header-actions">
                    <input type="text" id="docSearchInput" class="doc-search-input" placeholder="Search documents...">
                    <button class="btn btn-primary" id="docUploadBtn">+ Upload</button>
                </div>
            </div>
            <div class="doc-filters" id="docFilters">
                <button class="filter-tab active" data-filter="active">Active</button>
                <button class="filter-tab" data-filter="processing">Processing</button>
                <button class="filter-tab" data-filter="deleted">Deleted</button>
            </div>
            <div class="doc-list" id="docList">
                <div class="loading">Loading documents...</div>
            </div>
        </div>

        <!-- Document Preview Modal -->
        <div class="modal-overlay" id="docPreviewOverlay" style="display:none">
            <div class="modal modal-lg">
                <div class="modal-header">
                    <div class="modal-title-row">
                        <h3 id="docPreviewTitle">Document Preview</h3>
                        <button class="btn-close" id="docPreviewClose">&times;</button>
                    </div>
                    <div id="docPreviewMeta" class="doc-preview-meta"></div>
                </div>
                <div class="modal-body" id="docPreviewBody">
                    <div class="loading">Loading content...</div>
                </div>
                <div class="form-actions">
                    <a id="docDownloadLink" class="btn btn-secondary" href="#" download>Download Original</a>
                    <button id="docPreviewDeleteBtn" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>

        <!-- Scheduler Tab -->
        <div class="tab-panel" id="tab-scheduler">
            <div class="panel-header">
                <h2>Scheduler</h2>
                <button class="btn btn-primary" id="newScheduleBtn">+ New Schedule</button>
            </div>

            <!-- Filter bar -->
            <div class="scheduler-filters">
                <button class="filter-tab active" data-filter="all">All</button>
                <button class="filter-tab" data-filter="pending">Pending</button>
                <button class="filter-tab" data-filter="fired">Fired</button>
                <button class="filter-tab" data-filter="failed">Failed</button>
                <button class="filter-tab" data-filter="cancelled">Cancelled</button>
            </div>

            <!-- Item list -->
            <div class="scheduler-list" id="schedulerList">
                <div class="loading">Loading schedule‚Ä¶</div>
            </div>

            <!-- Pagination + utility row -->
            <div class="scheduler-footer" id="schedulerFooter" style="display:none">
                <button class="btn btn-secondary" id="scheduleLoadMoreBtn" style="display:none">Load more</button>
                <button class="btn btn-secondary" id="clearHistoryBtn" style="display:none">Clear History</button>
            </div>
        </div>
    </main>

    <!-- Create / Edit Schedule Modal -->
    <div class="modal-overlay hidden" id="scheduleModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2 id="scheduleModalTitle">New Schedule</h2>
                    <button class="btn-close" id="closeScheduleModal">‚úï</button>
                </div>
            </div>
            <form id="scheduleForm">
                <div class="form-group">
                    <label>Prompt / Message</label>
                    <textarea id="scheduleMessage" rows="3" maxlength="1000" placeholder="What Chalie should do when this fires"></textarea>
                    <p class="form-hint">Up to 1 000 characters</p>
                </div>
                <div class="form-group">
                    <label id="scheduleDueAtLabel">Due Date &amp; Time</label>
                    <input type="datetime-local" id="scheduleDueAt">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="scheduleType">
                        <option value="notification">Notification</option>
                        <option value="prompt">Prompt</option>
                    </select>
                    <p class="form-hint" id="typeHint">Notification surfaces the message directly. Prompt feeds it to Chalie for LLM processing.</p>
                </div>
                <div class="form-group">
                    <label>Recurrence</label>
                    <select id="scheduleRecurrence">
                        <option value="">None (one-time)</option>
                        <option value="interval">Every X minutes</option>
                        <option value="hourly">Hourly</option>
                        <option value="daily">Daily</option>
                        <option value="weekdays">Weekdays (Mon‚ÄìFri)</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    <p class="form-hint recurrence-hint" id="recurrenceHint" style="display:none"></p>
                </div>
                <div class="form-group" id="intervalGroup" style="display:none">
                    <label>Interval (minutes)</label>
                    <input type="number" id="scheduleIntervalMinutes" min="1" max="1440" value="30" placeholder="30">
                    <p class="form-hint">1‚Äì1440 min &nbsp;¬∑&nbsp; Examples: 30 = every 30 min, 90 = every 1.5 h</p>
                </div>
                <div class="form-group window-inputs-group" id="windowGroup" style="display:none">
                    <label>Active Window (local time)</label>
                    <div class="window-inputs">
                        <input type="time" id="scheduleWindowStart" placeholder="09:00">
                        <span class="window-sep">to</span>
                        <input type="time" id="scheduleWindowEnd" placeholder="17:00">
                    </div>
                    <p class="form-hint">Hourly fires only within this time window</p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelScheduleFormBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cancel Confirmation Modal -->
    <div class="modal-overlay hidden" id="cancelScheduleModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2>Cancel Schedule</h2>
                <p id="cancelScheduleDesc">Are you sure you want to cancel this scheduled item?</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="keepScheduleBtn">No, Keep It</button>
                <button class="btn btn-danger" id="confirmCancelScheduleBtn">Yes, Cancel</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay hidden" id="loginModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2>Dashboard Login</h2>
                <p>Enter your master account credentials.</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUsername" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" autocomplete="current-password" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Provider Form Modal (Add/Edit) -->
    <div class="modal-overlay hidden" id="providerModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2 id="providerModalTitle">Add Provider</h2>
                    <button type="button" class="btn-close" id="closeProviderModal">‚úï</button>
                </div>
            </div>
            <div class="platform-tabs" id="editPlatformTabs">
                <button class="platform-tab active" data-platform="ollama">Ollama</button>
                <button class="platform-tab" data-platform="anthropic">Anthropic</button>
                <button class="platform-tab" data-platform="openai">OpenAI</button>
                <button class="platform-tab" data-platform="gemini">Gemini</button>
            </div>
            <p class="platform-desc" id="editPlatformDesc"></p>
            <form id="providerForm">
                <input type="hidden" id="editProviderId">
                <div class="form-group">
                    <label>Provider Name</label>
                    <input type="text" id="editName" placeholder="e.g. My Ollama" required>
                </div>
                <div class="form-group" id="editHostGroup">
                    <label>Host</label>
                    <input type="text" id="editHost" value="http://localhost:11434">
                    <button type="button" class="btn btn-secondary" id="editTestConnectionBtn">Test Connection</button>
                    <span id="editConnectionStatus"></span>
                </div>
                <div class="form-group" id="editApiKeyGroup">
                    <label>API Key</label>
                    <input type="password" id="editApiKey" placeholder="Leave blank to keep existing key">
                </div>
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="editModel" placeholder="e.g. qwen3:8b" list="editModelSuggestions">
                    <datalist id="editModelSuggestions"></datalist>
                </div>
                <div id="testResult" class="test-result hidden"></div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelProviderBtn">Cancel</button>
                    <button type="button" class="btn btn-secondary" id="testProviderBtn">Test Connection</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay hidden" id="deleteModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2>Delete Provider</h2>
                <p id="deleteModalDesc">Are you sure you want to delete this provider?</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Install Tool Modal -->
    <div class="modal-overlay hidden" id="installModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2>Install Tool</h2>
                    <button class="btn-close" id="closeInstallModal">‚úï</button>
                </div>
            </div>
            <div class="platform-tabs" id="installMethodTabs">
                <button class="platform-tab active" data-install-method="git">Git URL</button>
                <button class="platform-tab" data-install-method="zip">Upload ZIP</button>
            </div>
            <div id="installGitPanel">
                <div class="form-group">
                    <label>Repository URL</label>
                    <input type="url" id="installGitUrl" placeholder="https://github.com/user/tool-repo">
                </div>
            </div>
            <div id="installZipPanel" class="hidden">
                <div class="form-group">
                    <label>ZIP File</label>
                    <input type="file" id="installZipFile" accept=".zip">
                </div>
            </div>
            <div id="installProgress" class="install-progress hidden"></div>
            <div id="installError" class="form-error hidden"></div>
            <div class="form-actions">
                <button class="btn btn-secondary" id="cancelInstallBtn">Cancel</button>
                <button class="btn btn-primary" id="installBtn">Install</button>
            </div>
        </div>
    </div>

    <!-- Tool Settings Modal -->
    <div class="modal-overlay hidden" id="toolSettingsModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2 id="toolSettingsTitle">Tool Settings</h2>
                    <button class="btn-close" id="closeToolSettingsModal">‚úï</button>
                </div>
            </div>
            <div id="toolSettingsForm"></div>
            <div class="form-actions">
                <button class="btn btn-secondary" id="cancelToolSettingsBtn">Cancel</button>
                <button class="btn btn-primary" id="saveToolSettingsBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Create List Modal -->
    <div class="modal-overlay hidden" id="createListModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2>New List</h2>
                    <button class="btn-close" id="closeCreateListModal">‚úï</button>
                </div>
            </div>
            <form id="createListForm">
                <div class="form-group">
                    <label>List Name</label>
                    <input type="text" id="createListName" maxlength="200" placeholder="e.g. Shopping List" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelCreateListBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename List Modal -->
    <div class="modal-overlay hidden" id="renameListModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2>Rename List</h2>
                    <button class="btn-close" id="closeRenameListModal">‚úï</button>
                </div>
            </div>
            <form id="renameListForm">
                <div class="form-group">
                    <label>New Name</label>
                    <input type="text" id="renameListName" maxlength="200" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelRenameListBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Rename</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete List Modal -->
    <div class="modal-overlay hidden" id="deleteListModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <h2>Delete List</h2>
                <p id="deleteListDesc">Are you sure you want to delete this list?</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelDeleteListBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteListBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
</body>
</html>
